<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shree Hari Agencies - Daily Report System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
        }
        
        .options {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 25px;
            margin-top: 30px;
        }
        
        .option-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 300px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }
        
        .option-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }
        
        .option-card h2 {
            color: #1a2a6c;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .option-card p {
            color: #666;
            margin-bottom: 25px;
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1a2a6c;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            border-color: #b21f1f;
            outline: none;
        }
        
        .back-btn {
            background: #6c757d;
            margin-top: 20px;
        }
        
        .dashboard {
            padding: 30px;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        
        .report-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .report-section h3 {
            color: #1a2a6c;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 20px;
            resize: vertical;
        }
        
        textarea:focus {
            border-color: #b21f1f;
            outline: none;
        }
        
        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: 600;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        
        .report-list {
            margin-top: 20px;
        }
        
        .report-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #1a2a6c;
        }
        
        .report-date {
            font-weight: bold;
            color: #1a2a6c;
            margin-bottom: 10px;
        }
        
        .report-content {
            white-space: pre-line;
            color: #555;
        }
        
        .time-notice {
            text-align: center;
            padding: 15px;
            background: #fff3cd;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 600;
            color: #856404;
        }
        
        .hidden {
            display: none;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: #1a2a6c;
            color: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: #1a2a6c;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        .date-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: #1a2a6c;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }
        
        .section-title {
            font-weight: bold;
            color: #1a2a6c;
            margin-bottom: 5px;
        }
        
        .required-notice {
            color: #b21f1f;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .view-toggle {
            display: flex;
            background: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .view-toggle button {
            flex: 1;
            padding: 12px;
            border: none;
            background: #f8f9fa;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .view-toggle button.active {
            background: #1a2a6c;
            color: white;
        }
        
        .summary-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #1a2a6c;
        }
        
        .summary-employee {
            font-weight: bold;
            color: #1a2a6c;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .summary-date {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }
        
        .summary-content {
            color: #333;
        }
        
        .summary-section {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #ddd;
        }
        
        .summary-section-title {
            font-weight: bold;
            color: #1a2a6c;
            margin-bottom: 5px;
        }
        
        .ai-badge {
            display: inline-block;
            background: #e6f7ff;
            color: #0066cc;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 8px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: #1a2a6c;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .staff-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .staff-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .staff-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-right: 20px;
        }
        
        .staff-info {
            flex: 1;
        }
        
        .staff-name {
            font-weight: bold;
            color: #1a2a6c;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .staff-email {
            color: #666;
            font-size: 0.9rem;
        }
        
        .staff-registration-date {
            color: #666;
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .staff-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }
        
        .search-box {
            display: flex;
            margin-bottom: 20px;
        }
        
        .search-box input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px 0 0 8px;
            font-size: 1rem;
        }
        
        .search-box button {
            padding: 12px 20px;
            background: #1a2a6c;
            color: white;
            border: none;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 5px;
        }
        
        .pagination button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
        }
        
        .pagination button.active {
            background: #1a2a6c;
            color: white;
        }
        
        @media (max-width: 768px) {
            .options {
                flex-direction: column;
                align-items: center;
            }
            
            .option-card {
                width: 100%;
                max-width: 400px;
            }
            
            .staff-card {
                flex-direction: column;
                text-align: center;
            }
            
            .staff-avatar {
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .staff-actions {
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Shree Hari Agencies</h1>
            <p class="subtitle">Daily Staff Report System</p>
        </header>
        
        <!-- Main Login Screen -->
        <div id="login-screen" class="login-container">
            <h2>Welcome to Daily Report System</h2>
            <p>Please select an option to continue</p>
            
            <div class="options">
                <div class="option-card" onclick="showForm('create-account')">
                    <h2>Create Staff Account</h2>
                    <p>Register as a new staff member</p>
                    <button class="btn">Create Account</button>
                </div>
                
                <div class="option-card" onclick="showForm('staff-login')">
                    <h2>Staff Login</h2>
                    <p>Log in to submit your daily report</p>
                    <button class="btn">Login</button>
                </div>
                
                <div class="option-card" onclick="showForm('owner-login')">
                    <h2>Owner Login</h2>
                    <p>Access all staff reports</p>
                    <button class="btn">Login</button>
                </div>
            </div>
        </div>
        
        <!-- Create Account Form -->
        <div id="create-account" class="login-container hidden">
            <h2>Create Staff Account</h2>
            
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" placeholder="Enter your email">
            </div>
            
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" placeholder="Enter your password">
                <small>Must contain at least 6 characters, one digit, and one special character</small>
            </div>
            
            <button class="btn" onclick="createAccount()">Create Account</button>
            <button class="btn back-btn" onclick="showLoginScreen()">Back</button>
            
            <div id="account-message" class="status-message hidden"></div>
        </div>
        
        <!-- Staff Login Form -->
        <div id="staff-login" class="login-container hidden">
            <h2>Staff Login</h2>
            
            <div class="form-group">
                <label for="staff-email">Email:</label>
                <input type="email" id="staff-email" placeholder="Enter your email">
            </div>
            
            <div class="form-group">
                <label for="staff-password">Password:</label>
                <input type="password" id="staff-password" placeholder="Enter your password">
            </div>
            
            <button class="btn" onclick="staffLogin()">Login</button>
            <button class="btn back-btn" onclick="showLoginScreen()">Back</button>
            
            <div id="staff-login-message" class="status-message hidden"></div>
        </div>
        
        <!-- Owner Login Form -->
        <div id="owner-login" class="login-container hidden">
            <h2>Owner Login</h2>
            
            <div class="form-group">
                <label for="owner-email">Email:</label>
                <input type="email" id="owner-email" placeholder="Enter your">
            </div>
            
            <div class="form-group">
                <label for="owner-password">Password:</label>
                <input type="password" id="owner-password" placeholder="Enter your password">
            </div>
            
            <button class="btn" onclick="ownerLogin()">Login</button>
            <button class="btn back-btn" onclick="showLoginScreen()">Back</button>
            
            <div id="owner-login-message" class="status-message hidden"></div>
        </div>
        
        <!-- Staff Dashboard -->
        <div id="staff-dashboard" class="dashboard hidden">
            <div class="dashboard-header">
                <h2>Staff Dashboard</h2>
                <button class="btn back-btn" onclick="showLoginScreen()">Logout</button>
            </div>
            
            <div class="report-section">
                <h3>Submit Daily Report</h3>
                <div id="time-notice" class="time-notice">
                    Reports can only be submitted after 6:00 PM India time
                </div>
                
                <div class="date-display" id="current-date"></div>
                
                <div class="form-group">
                    <div class="section-title">1. Marketing</div>
                    <textarea id="marketing-content" placeholder="Enter your marketing activities..."></textarea>
                </div>
                
                <div class="form-group">
                    <div class="section-title">2. Collection</div>
                    <textarea id="collection-content" placeholder="Enter your collection activities..."></textarea>
                </div>
                
                <div class="form-group">
                    <div class="section-title">3. Commission Received</div>
                    <textarea id="commission-content" placeholder="Enter your commission details..."></textarea>
                </div>
                
                <div class="form-group">
                    <div class="section-title">4. Accounts</div>
                    <textarea id="accounts-content" placeholder="Enter your accounts activities..."></textarea>
                </div>
                
                <div class="required-notice">* At least one section must be filled</div>
                
                <button class="btn" onclick="showConfirmModal()">Submit Report</button>
            </div>
            
            <div class="report-section">
                <h3>Edit Today's Report</h3>
                <button class="btn" onclick="editReport()">Edit Report</button>
                <div id="edit-report-container" class="hidden">
                    <div class="form-group">
                        <div class="section-title">1. Marketing</div>
                        <textarea id="edit-marketing-content" placeholder="Enter your marketing activities..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <div class="section-title">2. Collection</div>
                        <textarea id="edit-collection-content" placeholder="Enter your collection activities..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <div class="section-title">3. Commission Received</div>
                        <textarea id="edit-commission-content" placeholder="Enter your commission details..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <div class="section-title">4. Accounts</div>
                        <textarea id="edit-accounts-content" placeholder="Enter your accounts activities..."></textarea>
                    </div>
                    
                    <button class="btn" onclick="updateReport()">Update Report</button>
                    <button class="btn back-btn" onclick="cancelEdit()">Cancel</button>
                </div>
            </div>
            
            <div id="report-message" class="status-message hidden"></div>
        </div>
        
        <!-- Owner Dashboard -->
        <div id="owner-dashboard" class="dashboard hidden">
            <div class="dashboard-header">
                <h2>Owner Dashboard</h2>
                <button class="btn back-btn" onclick="showLoginScreen()">Logout</button>
            </div>
            
            <div class="view-toggle">
                <button id="daily-reports-btn" class="active" onclick="switchView('daily')">Daily Reports</button>
                <button id="summary-reports-btn" onclick="switchView('summary')">AI Summarized Reports</button>
                <button id="staff-list-btn" onclick="switchView('staff')">Staff Registration List</button>
            </div>
            
            <!-- Daily Reports View -->
            <div id="daily-reports-view">
                <div class="report-section">
                    <h3>All Staff Reports (Last 40 Days)</h3>
                    <div id="reports-container" class="report-list">
                        <!-- Reports will be loaded here -->
                    </div>
                    
                    <div class="delete-older-reports" id="delete-notice">
                        Reports older than 40 days will be automatically deleted.
                    </div>
                </div>
            </div>
            
            <!-- Summary Reports View -->
            <div id="summary-reports-view" class="hidden">
                <div class="report-section">
                    <h3>AI Summarized Reports (Last 30 Days)</h3>
                    <div id="summaries-container" class="report-list">
                        <!-- Summaries will be loaded here -->
                    </div>
                    
                    <div id="ai-processing" class="hidden">
                        <p>Generating AI summaries... <span class="loading-spinner"></span></p>
                    </div>
                    
                    <div class="delete-older-reports" id="summary-delete-notice">
                        Summaries are based on reports from the last 30 days.
                    </div>
                </div>
            </div>
            
            <!-- Staff Registration List View -->
            <div id="staff-list-view" class="hidden">
                <div class="report-section">
                    <h3>Staff Registration List</h3>
                    
                    <div class="search-box">
                        <input type="text" id="staff-search" placeholder="Search staff by email or name...">
                        <button onclick="searchStaff()">Search</button>
                    </div>
                    
                    <div id="staff-container" class="report-list">
                        <!-- Staff list will be loaded here -->
                    </div>
                    
                    <div id="staff-pagination" class="pagination">
                        <button onclick="changePage(-1)">&laquo; Previous</button>
                        <button class="active">1</button>
                        <button onclick="changePage(1)">Next &raquo;</button>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>&copy; 2023 Shree Hari Agencies. All rights reserved.</p>
        </footer>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Confirm Report Submission</h3>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Please confirm your report submission:</p>
                <div class="date-display" id="modal-date"></div>
                
                <div class="section-title">Marketing</div>
                <div id="preview-marketing" style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; white-space: pre-line;"></div>
                
                <div class="section-title">Collection</div>
                <div id="preview-collection" style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; white-space: pre-line;"></div>
                
                <div class="section-title">Commission Received</div>
                <div id="preview-commission" style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; white-space: pre-line;"></div>
                
                <div class="section-title">Accounts</div>
                <div id="preview-accounts" style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px; white-space: pre-line;"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn" onclick="confirmSubmitReport()">Confirm Submit</button>
            </div>
        </div>
    </div>
    <script>
        // Configuration
        const OWNER_EMAIL = "shreehariagencies12@gmail.com";
        const OWNER_PASSWORD = "Pratik@3";
        const ITEMS_PER_PAGE = 5;
        
        // Data storage using localStorage
        let staffAccounts = JSON.parse(localStorage.getItem('staffAccounts')) || {};
        let reports = JSON.parse(localStorage.getItem('reports')) || [];
        let currentUser = null;
        let currentPage = 1;
        
        // Navigation functions
        function showLoginScreen() {
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('create-account').classList.add('hidden');
            document.getElementById('staff-login').classList.add('hidden');
            document.getElementById('owner-login').classList.add('hidden');
            document.getElementById('staff-dashboard').classList.add('hidden');
            document.getElementById('owner-dashboard').classList.add('hidden');
            currentUser = null;
        }
        
        function showForm(formId) {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('create-account').classList.add('hidden');
            document.getElementById('staff-login').classList.add('hidden');
            document.getElementById('owner-login').classList.add('hidden');
            document.getElementById(formId).classList.remove('hidden');
        }
        
        // Account creation
        function createAccount() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const messageDiv = document.getElementById('account-message');
            
            if (!email || !password) {
                showMessage(messageDiv, "Please fill in all fields", "error");
                return;
            }
            
            if (!isValidEmail(email)) {
                showMessage(messageDiv, "Please enter a valid email address", "error");
                return;
            }
            
            if (!isPasswordValid(password)) {
                showMessage(messageDiv, "Password must be at least 6 characters and contain a digit and special character", "error");
                return;
            }
            
            if (staffAccounts[email]) {
                showMessage(messageDiv, "This email is already registered", "error");
                return;
            }
            
            // Add registration date
            const registrationDate = getCurrentIndiaTime().toISOString().split('T')[0];
            
            staffAccounts[email] = {
                password: password,
                registrationDate: registrationDate
            };
            
            localStorage.setItem('staffAccounts', JSON.stringify(staffAccounts));
            
            showMessage(messageDiv, "Account created successfully! You can now log in.", "success");
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
        }
        
        // Login functions
        function staffLogin() {
            const email = document.getElementById('staff-email').value.trim();
            const password = document.getElementById('staff-password').value;
            const messageDiv = document.getElementById('staff-login-message');
            
            if (!email || !password) {
                showMessage(messageDiv, "Please enter both email and password", "error");
                return;
            }
            
            if (!staffAccounts[email] || staffAccounts[email].password !== password) {
                showMessage(messageDiv, "Invalid email or password", "error");
                return;
            }
            
            currentUser = { email, type: 'staff' };
            showStaffDashboard();
        }
        
        function ownerLogin() {
            const email = document.getElementById('owner-email').value.trim();
            const password = document.getElementById('owner-password').value;
            const messageDiv = document.getElementById('owner-login-message');
            
            if (!email || !password) {
                showMessage(messageDiv, "Please enter both email and password", "error");
                return;
            }
            
            if (email !== OWNER_EMAIL || password !== OWNER_PASSWORD) {
                showMessage(messageDiv, "Invalid email or password", "error");
                return;
            }
            
            currentUser = { email, type: 'owner' };
            showOwnerDashboard();
        }
        
        // Dashboard functions
        function showStaffDashboard() {
            document.getElementById('owner-login').classList.add('hidden');
            document.getElementById('staff-dashboard').classList.remove('hidden');
            
            // Display current date
            const currentDate = getCurrentIndiaTime().toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('current-date').textContent = `Today: ${currentDate}`;
            
            // Check if after 6 PM India time
            const now = getIndiaTime();
            const hours = now.getHours();
            
            if (hours < 18) {
                document.getElementById('time-notice').style.display = 'block';
            } else {
                document.getElementById('time-notice').style.display = 'none';
            }
            
            // Check if already submitted report today
            const today = now.toISOString().split('T')[0];
            const hasReportToday = reports.some(r => r.email === currentUser.email && r.date === today);
            
            if (hasReportToday) {
                document.getElementById('report-message').innerHTML = "You have already submitted a report today. You can edit it below.";
                document.getElementById('report-message').className = "status-message warning";
                document.getElementById('report-message').classList.remove('hidden');
                document.getElementById('report-message').classList.remove('hidden');
            } else {
                document.getElementById('report-message').classList.add('hidden');
            }
        }
        
        function showOwnerDashboard() {
            document.getElementById('owner-login').classList.add('hidden');
            document.getElementById('owner-dashboard').classList.remove('hidden');
            loadAllReports();
        }
        
        // Report functions
        function showConfirmModal() {
            // Validate that at least one section is filled
            const marketing = document.getElementById('marketing-content').value.trim();
            const collection = document.getElementById('collection-content').value.trim();
            const commission = document.getElementById('commission-content').value.trim();
            const accounts = document.getElementById('accounts-content').value.trim();
            
            if (!marketing && !collection && !commission && !accounts) {
                showMessage(document.getElementById('report-message'), "At least one section must be filled", "error");
                return;
            }
            
            // Check if after 6 PM India time
            if (!isAfter6PM()) {
                showMessage(document.getElementById('report-message'), "Reports can only be submitted after 6:00 PM India time", "error");
                return;
            }
            
            // Check if already submitted report today
            const today = getCurrentIndiaTime().toISOString().split('T')[0];
            const existingReportIndex = reports.findIndex(r => r.email === currentUser.email && r.date === today);
            
            if (existingReportIndex !== -1) {
                showMessage(document.getElementById('report-message'), "You have already submitted a report today. Use the edit option below.", "warning");
                return;
            }
            
            // Show modal with confirmation
            const currentDate = getCurrentIndiaTime().toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('modal-date').textContent = `Submission Date: ${currentDate}`;
            
            // Preview each section
            document.getElementById('preview-marketing').textContent = marketing || "No marketing activities reported";
            document.getElementById('preview-collection').textContent = collection || "No collection activities reported";
            document.getElementById('preview-commission').textContent = commission || "No commission activities reported";
            document.getElementById('preview-accounts').textContent = accounts || "No accounts activities reported";
            
            document.getElementById('confirm-modal').style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('confirm-modal').style.display = 'none';
        }
        
        function confirmSubmitReport() {
            const marketing = document.getElementById('marketing-content').value.trim();
            const collection = document.getElementById('collection-content').value.trim();
            const commission = document.getElementById('commission-content').value.trim();
            const accounts = document.getElementById('accounts-content').value.trim();
            
            const today = getCurrentIndiaTime().toISOString().split('T')[0];
            
            reports.push({
                email: currentUser.email,
                date: today,
                marketing: marketing,
                collection: collection,
                commission: commission,
                accounts: accounts
            });
            
            // Save data and clean up old reports
            saveData();
            cleanOldReports();
            
            closeModal();
            showMessage(document.getElementById('report-message'), "Report submitted successfully!", "success");
            
            // Clear all textareas
            document.getElementById('marketing-content').value = '';
            document.getElementById('collection-content').value = '';
            document.getElementById('commission-content').value = '';
            document.getElementById('accounts-content').value = '';
        }
        
        function editReport() {
            const today = getCurrentIndiaTime().toISOString().split('T')[0];
            const todayReport = reports.find(r => r.email === currentUser.email && r.date === today);
            
            if (!todayReport) {
                showMessage(document.getElementById('report-message'), "You haven't submitted a report today yet", "error");
                return;
            }
            
            // Fill in the edit form with existing data
            document.getElementById('edit-marketing-content').value = todayReport.marketing || '';
            document.getElementById('edit-collection-content').value = todayReport.collection || '';
            document.getElementById('edit-commission-content').value = todayReport.commission || '';
            document.getElementById('edit-accounts-content').value = todayReport.accounts || '';
            
            document.getElementById('edit-report-container').classList.remove('hidden');
        }
        
        function updateReport() {
            const today = getCurrentIndiaTime().toISOString().split('T')[0];
            const todayReportIndex = reports.findIndex(r => r.email === currentUser.email && r.date === today);
            
            if (todayReportIndex === -1) {
                showMessage(document.getElementById('report-message'), "Report not found", "error");
                return;
            }
            
            const marketing = document.getElementById('edit-marketing-content').value.trim();
            const collection = document.getElementById('edit-collection-content').value.trim();
            const commission = document.getElementById('edit-commission-content').value.trim();
            const accounts = document.getElementById('edit-accounts-content').value.trim();
            
            // Validate that at least one section is filled
            if (!marketing && !collection && !commission && !accounts) {
                showMessage(document.getElementById('report-message'), "At least one section must be filled", "error");
                return;
            }
            
            reports[todayReportIndex] = {
                email: currentUser.email,
                date: today,
                marketing: marketing,
                collection: collection,
                commission: commission,
                accounts: accounts
            };
            
            saveData();
            
            document.getElementById('edit-report-container').classList.add('hidden');
            showMessage(document.getElementById('report-message'), "Report updated successfully!", "success");
        }
        
        function cancelEdit() {
            document.getElementById('edit-report-container').classList.add('hidden');
        }
        
        function loadAllReports() {
            const container = document.getElementById('reports-container');
            container.innerHTML = '';
            
            // Clean up old reports first
            cleanReports();
            
            if (reports.length === 0) {
                container.innerHTML = '<p>No reports found</p>';
                return;
            }
            
            // Filter reports from the last 40 days
            const fortyDaysAgo = new Date(getCurrentIndiaTime());
            fortyDaysAgo.setDate(fortyDaysAgo.getDate() - 40);
            
            const recentReports = reports.filter(report => {
                const reportDate = new Date(report.date);
                return reportDate >= fortyDaysAgo;
            });
            
            if (recentReports.length === 0) {
                container.innerHTML = '<p>No reports from the last 40 days</p>';
                return;
            }
            
            // Group reports by date
            const reportsByDate = {};
            recentReports.forEach(report => {
                if (!reportsByDate[report.date]) {
                    reportsByDate[report.date] = [];
                }
                reportsByDate[report.date].push(report);
            });
            
            // Sort dates in descending order
            const sortedDates = Object.keys(reportsByDate).sort().reverse();
            
            sortedDates.forEach(date => {
                const dateHeader = document.createElement('h4');
                dateHeader.textContent = formatDate(date);
                container.appendChild(dateHeader);
                
                reportsByDate[date].forEach(report => {
                    const reportDiv = document.createElement('div');
                    reportDiv.className = 'report-item';
                    
                    const emailDiv = document.createElement('div');
                    emailDiv.className = 'report-email';
                    emailDiv.textContent = `Staff: ${report.email}`;
                    
                    // Create sections for each part of the report
                    const sections = [
                        { title: 'Marketing', content: report.marketing },
                        { title: 'Collection', content: report.collection },
                        { title: 'Commission Received', content: report.commission },
                        { title: 'Accounts', content: report.accounts }
                    ];
                    
                    sections.forEach(section => {
                        if (section.content) {
                            const sectionDiv = document.createElement('div');
                            sectionDiv.className = 'report-section';
                            
                            const sectionTitle = document.createElement('div');
                            sectionTitle.className = 'section-title';
                            sectionTitle.textContent = section.title;
                            
                            const sectionContent = document.createElement('div');
                            sectionContent.className = 'report-content';
                            sectionContent.textContent = section.content;
                            
                            sectionDiv.appendChild(sectionTitle);
                            sectionDiv.appendChild(sectionContent);
                            reportDiv.appendChild(sectionDiv);
                        }
                    });
                    
                    container.appendChild(reportDiv);
                });
            });
            
            // Show notice about deleted reports
            const deletedCount = reports.length - recentReports.length;
            if (deletedCount > 0) {
                document.getElementById('delete-notice').textContent = 
                    `${deletedCount} reports older than 40 days were automatically deleted.`;
            }
        }
        
        // AI Summary Functions
        function generateAISummary() {
            const container = document.getElementById('summaries-container');
            const processingDiv = document.getElementById('ai-processing');
            
            // Show loading indicator
            processingDiv.classList.remove('hidden');
            container.innerHTML = '';
            
            // Simulate AI processing time
            setTimeout(() => {
                // Get reports from the last 30 days
                const thirtyDaysAgo = new Date(getCurrentIndiaTime());
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                const recentReports = reports.filter(report => {
                    const reportDate = new Date(report.date);
                    return reportDate >= thirtyDaysAgo;
                });
                
                if (recentReports.length === 0) {
                    container.innerHTML = '<p>No reports from the last 30 days</p>';
                    processingDiv.classList.add('hidden');
                    return;
                }
                
                // Group reports by employee
                const reportsByEmployee = {};
                recentReports.forEach(report => {
                    if (!reportsByEmployee[report.email]) {
                        reportsByEmployee[report.email] = [];
                    }
                    reportsByEmployee[report.email].push(report);
                });
                
                // Generate summaries for each employee
                Object.keys(reportsByEmployee).forEach(email => {
                    const employeeReports = reportsByEmployee[email];
                    
                    // Create summary card
                    const summaryCard = document.createElement('div');
                    summaryCard.className = 'summary-card';
                    
                    const employeeHeader = document.createElement('div');
                    employeeHeader.className = 'summary-employee';
                    employeeHeader.textContent = `Employee: ${email}`;
                    summaryCard.appendChild(employeeHeader);
                    
                    // Generate AI summary
                    const summary = generateAIReportSummary(employeeReports);
                    
                    const summaryContent = document.createElement('div');
                    summaryContent.className = 'summary-content';
                    summaryContent.textContent = summary;
                    summaryCard.appendChild(summaryContent);
                    
                    // Add AI badge
                    const aiBadge = document.createElement('span');
                    aiBadge.className = 'ai-badge';
                    aiBadge.textContent = 'AI Generated';
                    summaryCard.appendChild(aiBadge);
                    
                    container.appendChild(summaryCard);
                });
                
                processingDiv.classList.add('hidden');
            }, 2000); // Simulate 2 seconds processing time
        }
        
        function generateAIReportSummary(employeeReports) {
            // Simple AI summarization logic
            let summary = '';
            
            // Count activities by category
            let marketingCount = 0;
            let collectionCount = 0;
            let commissionTotal = 0;
            let accountsCount = 0;
            
            let marketingHighlights = [];
            let collectionHighlights = [];
            let commissionHighlights = [];
            let accountsHighlights = [];
            
            employeeReports.forEach(report => {
                if (report.marketing) {
                    marketingCount++;
                    if (report.marketing.length > 50) {
                        marketingHighlights.push(report.marketing.substring(0, 100) + '...');
                    }
                }
                
                if (report.collection) {
                    collectionCount++;
                    if (report.collection.length > 50) {
                        collectionHighlights.push(report.collection.substring(0, 100) + '...');
                    }
                }
                
                if (report.commission) {
                    commissionTotal++;
                    if (report.commission.includes('₹') || report.commission.includes('$')) {
                        commissionHighlights.push(report.commission);
                    }
                }
                
                if (report.accounts) {
                    accountsCount++;
                    if (report.accounts.length > 50) {
                        accountsHighlights.push(report.accounts.substring(0, 100) + '...');
                    }
                }
            });
            
            // Generate summary
            summary += `Over the past 30 days, this employee has been active in ${marketingCount} marketing activities, `;
            summary += `${collectionCount} collection activities, and completed ${accountsCount} accounts-related tasks. `;
            
            if (commissionTotal > 0) {
                summary += `They have processed ${commissionTotal} commission-related transactions. `;
            }
            
            // Add highlights
            if (marketingHighlights.length > 0) {
                summary += `Key marketing activities included: ${marketingHighlights.join('; ')}. `;
            }
            
            if (collectionHighlights.length > 0) {
                summary += `Notable collection activities: ${collectionHighlights.join('; ')}. `;
            }
            
            if (commissionHighlights.length > 0) {
                summary += `Commission transactions: ${commissionHighlights.join('; ')}. `;
            }
            
            if (accountsHighlights.length > 0) {
                summary += `Important accounts activities: ${accountsHighlights.join('; ')}. `;
            }
            
            // Add overall assessment
            if (marketingCount + collectionCount + commissionTotal + accountsCount > 20) {
                summary += `The employee has shown high activity levels across all departments.`;
            } else if (marketingCount + collectionCount + commissionTotal + accountsCount > 10) {
                summary += `The employee has maintained consistent activity levels throughout the period.`;
            } else {
                summary += `The employee has focused on specific areas with targeted efforts.`;
            }
            
            return summary;
        }
        
        // Staff Registration List Functions
        function loadStaffList() {
            const container = document.getElementById('staff-container');
            container.innerHTML = '';
            
            // Get all staff emails
            const staffEmails = Object.keys(staffAccounts);
            
            if (staffEmails.length === 0) {
                container.innerHTML = '<p>No staff registered yet</p>';
                return;
            }
            
            // Calculate pagination
            const totalPages = Math.ceil(staffEmails.length / ITEMS_PER_PAGE);
            if (currentPage > totalPages) {
                currentPage = totalPages;
            }
            
            // Get current page items
            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = Math.min(startIndex + ITEMS_PER_PAGE, staffEmails.length);
            const currentStaff = staffEmails.slice(startIndex, endIndex);
            
            // Create staff cards
            currentStaff.forEach(email => {
                const staffData = staffAccounts[email];
                
                const staffCard = document.createElement('div');
                staffCard.className = 'staff-card';
                
                const avatarDiv = document.createElement('div');
                avatarDiv.className = 'staff-avatar';
                // Get first letter of name for avatar
                const initial = email.split('@')[0].charAt(0).toUpperCase();
                avatarDiv.textContent = initial;
                
                const infoDiv = document.createElement('div');
                infoDiv.className = 'staff-info';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'staff-name';
                nameDiv.textContent = email;
                
                const emailDiv = document.createElement('div');
                emailDiv.className = 'staff-email';
                emailDiv.textContent = `Email: ${email}`;
                
                const regDateDiv = document.createElement('div');
                regDateDiv.className = 'staff-registration-date';
                regDateDiv.textContent = `Registered on: ${formatDate(staffData.registrationDate)}`;
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'staff-actions';
                
                const viewBtn = document.createElement('button');
                viewBtn.className = 'btn btn-sm';
                viewBtn.textContent = 'View Reports';
                viewBtn.onclick = function() {
                    switchView('daily');
                    loadAllReports();
                    document.getElementById('daily-reports-view').scrollIntoView({ behavior: 'smooth' });
                };
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-sm back-btn';
                deleteBtn.textContent = 'Delete Account';
                deleteBtn.onclick = function() {
                    if (confirm(`Are you sure you want to delete the account for ${email}?`)) {
                        delete staffAccounts[email];
                        localStorage.setItem('staffAccounts', JSON.stringify(staffAccounts));
                        loadStaffList();
                        showMessage(document.getElementById('report-message'), `Account for ${email} has been deleted.`, 'success');
                    }
                };
                
                actionsDiv.appendChild(viewBtn);
                actionsDiv.appendChild(deleteBtn);
                
                infoDiv.appendChild(nameDiv);
                infoDiv.appendChild(emailDiv);
                infoDiv.appendChild(regDateDiv);
                
                staffCard.appendChild(avatarDiv);
                staffCard.appendChild(infoDiv);
                staffCard.appendChild(actionsDiv);
                
                container.appendChild(staffCard);
            });
            
            // Update pagination
            updatePagination(totalPages);
        }
        
        function updatePagination(totalPages) {
            const pagination = document.getElementById('staff-pagination');
            pagination.innerHTML = '';
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }
            
            pagination.style.display = 'flex';
            
            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.textContent = 'Previous';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = function() {
                if (currentPage > 1) {
                    currentPage--;
                    loadStaffList();
                }
            };
            pagination.appendChild(prevBtn);
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                pageBtn.className = i === currentPage ? 'active' : '';
                pageBtn.onclick = function() {
                    currentPage = i;
                    loadStaffList();
                };
                pagination.appendChild(pageBtn);
            }
            
            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'Next';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = function() {
                if (currentPage < totalPages) {
                    currentPage++;
                    loadStaffList();
                }
            };
            pagination.appendChild(nextBtn);
        }
        
        function changePage(direction) {
            const totalPages = Math.ceil(Object.keys(staffAccounts).length / ITEMS_PER_PAGE);
            if (direction === -1 && currentPage > 1) {
                currentPage--;
            } else if (direction === 1 && currentPage < totalPages) {
                currentPage++;
            }
            loadStaffList();
        }
        
        function searchStaff() {
            const searchTerm = document.getElementById('staff-search').value.trim().toLowerCase();
            const container = document.getElementById('staff-container');
            container.innerHTML = '';
            
            // Filter staff based on search term
            const filteredStaff = Object.keys(staffAccounts).filter(email => 
                email.toLowerCase().includes(searchTerm)
            );
            
            if (filteredStaff.length === 0) {
                container.innerHTML = '<p>No matching staff found</p>';
                return;
            }
            
            // Display filtered staff
            filteredStaff.forEach(email => {
                const staffData = staffAccounts[email];
                
                const staffCard = document.createElement('div');
                staffCard.className = 'staff-card';
                
                const avatarDiv = document.createElement('div');
                avatarDiv.className = 'staff-avatar';
                const initial = email.split('@')[0].charAt(0).toUpperCase();
                avatarDiv.textContent = initial;
                
                const infoDiv = document.createElement('div');
                infoDiv.className = 'staff-info';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'staff-name';
                nameDiv.textContent = email;
                
                const emailDiv = document.createElement('div');
                emailDiv.className = 'staff-email';
                emailDiv.textContent = `Email: ${email}`;
                
                const regDateDiv = document.createElement('div');
                regDateDiv.className = 'staff-registration-date';
                regDateDiv.textContent = `Registered on: ${formatDate(staffData.registrationDate)}`;
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'staff-actions';
                
                const viewBtn = document.createElement('button');
                viewBtn.className = 'btn btn-sm';
                viewBtn.textContent = 'View Reports';
                viewBtn.onclick = function() {
                    switchView('daily');
                    loadAllReports();
                    document.getElementById('daily-reports-view').scrollIntoView({ behavior: 'smooth' });
                };
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-sm back-btn';
                deleteBtn.textContent = 'Delete Account';
                deleteBtn.onclick = function() {
                    if (confirm(`Are you sure you want to delete the account for ${email}?`)) {
                        delete staffAccounts[email];
                        localStorage.setItem('staffAccounts', JSON.stringify(staffAccounts));
                        loadStaffList();
                        showMessage(document.getElementById('report-message'), `Account for ${email} has been deleted.`, 'success');
                    }
                };
                
                actionsDiv.appendChild(viewBtn);
                actionsDiv.appendChild(deleteBtn);
                
                infoDiv.appendChild(nameDiv);
                infoDiv.appendChild(emailDiv);
                infoDiv.appendChild(regDateDiv);
                
                staffCard.appendChild(avatarDiv);
                staffCard.appendChild(infoDiv);
                staffCard.appendChild(actionsDiv);
                
                container.appendChild(staffCard);
            });
        }
        
        // View switching function
        function switchView(view) {
            if (view === 'daily') {
                document.getElementById('daily-reports-btn').classList.add('active');
                document.getElementById('summary-reports-btn').classList.remove('active');
                document.getElementById('staff-list-btn').classList.remove('active');
                document.getElementById('daily-reports-view').classList.remove('hidden');
                document.getElementById('summary-reports-view').classList.add('hidden');
                document.getElementById('staff-list-view').classList.add('hidden');
            } else if (view === 'summary') {
                document.getElementById('daily-reports-btn').classList.remove('active');
                document.getElementById('summary-reports-btn').classList.add('active');
                document.getElementById('staff-list-btn').classList.remove('active');
                document.getElementById('daily-reports-view').classList.add('hidden');
                document.getElementById('summary-reports-view').classList.remove('hidden');
                document.getElementById('staff-list-view').classList.add('hidden');
                generateAISummary();
            } else if (view === 'staff') {
                document.getElementById('daily-reports-btn').classList.remove('active');
                document.getElementById('summary-reports-btn').classList.remove('active');
                document.getElementById('staff-list-btn').classList.add('active');
                document.getElementById('daily-reports-view').classList.add('hidden');
                document.getElementById('summary-reports-view').classList.add('hidden');
                document.getElementById('staff-list-view').classList.remove('hidden');
                loadStaffList();
            }
        }
        
        // Utility functions
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        function isPasswordValid(password) {
            return password.length >= 6 && /\d/.test(password) && /[!@#$%^&*(),.?":{}|<>]/.test(password);
        }
        
        function getCurrentIndiaTime() {
            return new Date(new Date().toLocaleString("en-US", {timeZone: "Asia/Kolkata"}));
        }
        
        function getIndiaTime() {
            return new Date(new Date().toLocaleString("en-US", {timeZone: "Asia/Kolkata"}));
        }
        
        function isAfter6PM() {
            const now = new Date(new Date().toLocaleString("en-US", {timeZone: "Asia/Kolkata"}));
            return now.getHours() >= 18;
        }
        
        function hasReportToday(email) {
            const today = new Date(new Date().toLocaleString("en-US", {timeZone: "Asia/Kolkata"})).toISOString().split('T')[0];
            return reports.some(r => r.email === email && r.date === today);
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }
        
        function showMessage(element, message, type) {
            element.textContent = message;
            element.className = `status-message ${type}`;
            element.classList.remove('hidden');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                element.classList.add('hidden');
            }, 5000);
        }
        
        function cleanOldReports() {
            const fortyDaysAgo = new Date(getCurrentIndiaTime());
            fortyDaysAgo.setDate(fortyDaysAgo.getDate() - 40);
            
            const initialCount = reports.length;
            reports = reports.filter(report => {
                const reportDate = new Date(report.date);
                return reportDate >= fortyDaysAgo;
            });
            
            if (initialCount !== reports.length) {
                localStorage.setItem('reports', JSON.stringify(reports));
            }
        }
        
        function saveData() {
            localStorage.setItem('staffAccounts', JSON.stringify(staffAccounts));
            localStorage.setItem('reports', JSON.stringify(reports));
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            showLoginScreen();
        });
    </script>
</body>
</html>
